<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Small Business Dashboard</title>
    <link rel="stylesheet" href="small-business-styles.css">
    <script src="https://cdn.ethers.io/lib/ethers-5.0.umd.min.js"></script>
</head>
<body>
    <header>
        <div class="logo">
            <img src="logo.png" alt="Acquior Technology Logo">
        </div>
        <button class="connect-wallet" onclick="connectWallet()">Connect Wallet</button>
    </header>
    <main>
        <h1>Create Invoice</h1>
        <form id="invoice-form" onsubmit="createInvoice(event)">
            <label for="recipient-address">Recipient Address</label>
            <input type="text" id="recipient-address" placeholder="Enter recipient address" required>
            <label for="amount-matic">Amount in MATIC</label>
            <input type="number" id="amount-matic" placeholder="Enter amount in MATIC" required>
            <button type="submit" class="create-invoice-btn">Create Invoice</button>
        </form>
        <div class="status-message">
            Status messages and error notifications will appear here.
        </div>
        <section class="invoice-list">
            <h2>Your Invoices</h2>
        </section>
    </main>
    <footer>
        <nav class="footer-nav">
            <a href="index.html" class="nav-icon">Home</a>
            <a href="#" class="nav-icon">Invoices</a>
            <a href="#" class="nav-icon">Menu</a>
        </nav>
    </footer>
    <script>
        let provider;
        let signer;
        let contract;

        const contractAddress = '0xe4d5De9eb7b059d6AC206a021aCa3967975658d9';
        const contractABI = [
            "function createInvoice(address recipient, uint256 amount) public returns (uint256)",
            "function getInvoiceDetails(uint256 tokenId) public view returns (uint256, address, address, bool, bool, uint256)"
        ];

        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    await ethereum.request({ method: 'eth_requestAccounts' });
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    signer = provider.getSigner();
                    contract = new ethers.Contract(contractAddress, contractABI, signer);
                    const address = await signer.getAddress();
                    document.querySelector('.connect-wallet').textContent = `Connected: ${address.slice(0, 6)}...${address.slice(-4)}`;
                } catch (error) {
                    console.error('Failed to connect wallet:', error);
                }
            } else {
                alert('Please install MetaMask!');
            }
        }

        async function createInvoice(event) {
            event.preventDefault();
            const recipient = document.getElementById('recipient-address').value;
            const amountMatic = document.getElementById('amount-matic').value;
            const amountWei = ethers.utils.parseEther(amountMatic);

            try {
                const tx = await contract.createInvoice(recipient, amountWei);
                console.log('Transaction sent:', tx.hash);
                await tx.wait();
                console.log('Invoice created');
            } catch (error) {
                console.error('Error creating invoice:', error);
            }
        }
    </script>
</body>
</html>
